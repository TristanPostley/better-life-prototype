<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session 03130342-b0fe-444a-a233-dea4e4a427dc (2025-12-08 02:16Z) -->

# Document project conventions and inconsistencies (2025-12-08 02:16Z)

_**User (2025-12-04 01:03Z)**_

The @conventions folder has a series of empty files which need to be populated with the conventions to be followed in this project. Refer to the existing project files to describe the proper conventions to follow for future reference. Note instances where there is no convention that is consistently followed.

---

_**Agent (model default, mode Agent)**_



---


Analyzing the codebase to document conventions. Reviewing key files to understand current patterns.


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: conventions/README.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: conventions/folder-structure.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: conventions/naming-conventions.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: conventions/error-handling.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: conventions/imports-and-dependencies.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: conventions/client-server-boundaries.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: conventions/testing-organization.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: conventions/DOMAIN_STRUCTURE_PROPOSAL.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: conventions/DOMAIN_STRUCTURE_TREE.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: conventions/MIGRATION_STATUS.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: ARCHITECTURE.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: CLIENT_SERVER_CLASSIFICATION.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: blueprint.md</summary>

</details>
</tool-use>

---



---


Examining code files to understand patterns:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/client/app.js</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/client/domains/auth/auth-ui.js</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/client/domains/auth/index.js</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/client/domains/sessions/index.js</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/client/domains/navigation/index.js</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/shared/domains/auth/types.js</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/shared/utils/error-handler.js</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/client/utils/dom-elements.js</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/client/state/app-state.js</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/client/services/supabase-client.js</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: package.json</summary>

</details>
</tool-use>

---



---


Reviewing additional files to understand patterns:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/client/state/state-manager.js</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/client/utils/module-registry.js</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/shared/constants.js</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/client/domains/sessions/timer.js</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_directory** • Listed directory undefined • **0** results</summary>
        
No results found
</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: tests/README.md</summary>

</details>
</tool-use>

---



---


Populating the convention files based on the codebase patterns. Starting with the main files:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/shared/types/api.js</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/shared/types/state.js</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/shared/types/dom.js</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="codebase_search">
<details>
                <summary>Tool use: **codebase_search** • Searched codebase "How are domain modules structured and organized?" • **4** results</summary>
            
| File | Lines |
|------|-------|
| `blueprint.md` | L60 |
| `SUPABASE_SETUP.md` | L53 |
| `index.html` | L106-135 |
| `blueprint.md` | L56-67 |

</details>
</tool-use>

---



---


Populating the convention files based on the codebase patterns:


---

<tool-use data-tool-type="write" data-tool-name="write">

<details><summary>Tool use: **code_edit** • Edit file: conventions/README.md</summary>

**Chunk 1**
Lines added: 41, lines removed: 1

```diff
@@ -1,1 +1,41 @@
- 
+ # Project Conventions
+ 
+ This directory contains documentation of the conventions and patterns used throughout the Better Life project. These conventions help maintain consistency, improve code quality, and guide future development.
+ 
+ ## Convention Documents
+ 
+ - **[Folder Structure](folder-structure.md)** - Directory organization and file placement rules
+ - **[Naming Conventions](naming-conventions.md)** - How to name files, functions, variables, and types
+ - **[Error Handling](error-handling.md)** - Standardized error handling patterns
+ - **[Imports and Dependencies](imports-and-dependencies.md)** - Module import patterns and dependency management
+ - **[Client-Server Boundaries](client-server-boundaries.md)** - Separation between client and server code
+ - **[Testing Organization](testing-organization.md)** - Test file structure and testing patterns
+ - **[Domain Structure](DOMAIN_STRUCTURE_PROPOSAL.md)** - Domain-driven design organization
+ - **[Domain Structure Tree](DOMAIN_STRUCTURE_TREE.md)** - Visual representation of domain organization
+ - **[Migration Status](MIGRATION_STATUS.md)** - Current migration state and progress
+ 
+ ## Purpose
+ 
+ These conventions serve as:
+ 
+ 1. **Reference Documentation** - Quick lookup for how things should be done
+ 2. **Onboarding Guide** - Help new contributors understand the codebase
+ 3. **Consistency Enforcement** - Ensure all code follows the same patterns
+ 4. **Decision Record** - Document why certain patterns were chosen
+ 
+ ## When to Update
+ 
+ Update these documents when:
+ 
+ - New patterns emerge that should be standardized
+ - Existing patterns are refactored or improved
+ - Inconsistencies are discovered and resolved
+ - New conventions are established through team discussion
+ 
+ ## Note on Inconsistencies
+ 
+ Some areas of the codebase may not yet follow these conventions consistently. The documents note where conventions are:
+ - **Consistently followed** - Pattern is well-established
+ - **Partially followed** - Some code follows, some doesn&#39;t
+ - **Not yet established** - No clear pattern exists yet
+ 
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="write">

<details><summary>Tool use: **code_edit** • Edit file: conventions/folder-structure.md</summary>

**Chunk 1**
Lines added: 184, lines removed: 1

```diff
@@ -1,1 +1,184 @@
- 
+ # Folder Structure Conventions
+ 
+ This document describes the standard folder structure and file organization patterns used in the Better Life project.
+ 
+ ## Root Structure
+ 
+ &#96;&#96;&#96;
+ Better Life/
+ ├── src/                    # Source code
+ │   ├── client/            # Client-side code (browser)
+ │   ├── server/            # Server-side code (minimal)
+ │   └── shared/            # Shared code (types, constants, utilities)
+ ├── tests/                 # Test files
+ ├── conventions/           # Project conventions documentation
+ ├── index.html            # Main HTML entry point
+ ├── styles.css            # Global styles
+ └── package.json          # Node.js dependencies
+ &#96;&#96;&#96;
+ 
+ ## Client Code (&#96;src/client/&#96;)
+ 
+ Client code runs in the browser and uses browser APIs (DOM, localStorage, etc.).
+ 
+ ### Structure
+ 
+ &#96;&#96;&#96;
+ src/client/
+ ├── app.js                 # Main application entry point
+ ├── domains/               # Domain modules (feature-based organization)
+ │   ├── auth/
+ │   │   ├── auth-ui.js    # Auth UI handlers
+ │   │   └── index.js      # Public API exports
+ │   ├── sessions/
+ │   │   ├── timer.js
+ │   │   ├── streak.js
+ │   │   ├── timer-service.js
+ │   │   ├── index.js
+ │   │   └── utils/        # Domain-specific utilities
+ │   │       ├── progress-ring.js
+ │   │       └── time-format.js
+ │   ├── navigation/
+ │   ├── reflection/
+ │   ├── users/
+ │   │   └── preferences/  # Nested domain features
+ │   └── feedback/
+ ├── services/              # External service clients
+ │   └── supabase-client.js
+ ├── state/                 # State management
+ │   ├── app-state.js      # State exports (backward compatibility)
+ │   └── state-manager.js  # State manager implementation
+ └── utils/                 # Client-specific utilities
+     ├── dom-elements.js    # DOM element caching
+     ├── dom-helpers.js    # DOM manipulation helpers
+     ├── button-handlers.js
+     └── module-registry.js # Module dependency registry
+ &#96;&#96;&#96;
+ 
+ ### Conventions
+ 
+ - **Domain modules** are organized by feature/domain (auth, sessions, navigation, etc.)
+ - Each domain has an &#96;index.js&#96; that exports the public API
+ - Domain-specific utilities go in a &#96;utils/&#96; subdirectory within the domain
+ - Client-only utilities go in &#96;src/client/utils/&#96;
+ - State management is centralized in &#96;src/client/state/&#96;
+ 
+ ## Shared Code (&#96;src/shared/&#96;)
+ 
+ Shared code contains types, constants, and utilities that could theoretically be used by both client and server (though currently only client uses them).
+ 
+ ### Structure
+ 
+ &#96;&#96;&#96;
+ src/shared/
+ ├── types/                 # Type definitions (JSDoc)
+ │   ├── api.js            # API response types
+ │   ├── dom.js            # DOM element types
+ │   └── state.js          # State types
+ ├── domains/               # Domain-specific types
+ │   ├── auth/
+ │   │   └── types.js
+ │   ├── users/
+ │   │   └── types.js
+ │   ├── sessions/
+ │   │   └── types.js
+ │   ├── reflection/
+ │   │   └── types.js
+ │   └── feedback/
+ │       └── types.js
+ ├── utils/                 # Shared utilities
+ │   ├── error-handler.js  # Error handling utilities
+ │   ├── transitions.js
+ │   └── index.js          # Utility exports
+ ├── state/                 # Shared state structure (types only)
+ │   └── app-state.js      # State type definitions
+ └── constants.js          # Application-wide constants
+ &#96;&#96;&#96;
+ 
+ ### Conventions
+ 
+ - **Types** are defined using JSDoc &#96;@typedef&#96; comments
+ - Types are organized by domain in &#96;src/shared/domains/&#96;
+ - Global types (API, DOM, State) go in &#96;src/shared/types/&#96;
+ - Constants are centralized in &#96;src/shared/constants.js&#96;
+ - Shared utilities are pure functions with no side effects
+ 
+ ## Server Code (&#96;src/server/&#96;)
+ 
+ Currently minimal - only contains database schema.
+ 
+ ### Structure
+ 
+ &#96;&#96;&#96;
+ src/server/
+ └── database/
+     └── schema.sql        # PostgreSQL/Supabase schema
+ &#96;&#96;&#96;
+ 
+ ## Test Files (&#96;tests/&#96;)
+ 
+ ### Structure
+ 
+ &#96;&#96;&#96;
+ tests/
+ ├── README.md             # Test documentation
+ ├── run-tests.js          # Test runner
+ ├── test-helpers.js       # Test utilities
+ ├── api-response-guards.test.js
+ ├── utils-guards.test.js
+ ├── guardrails.test.js
+ ├── state-manager.test.js
+ └── *.test.js            # Other test files
+ &#96;&#96;&#96;
+ 
+ ### Conventions
+ 
+ - Test files use &#96;.test.js&#96; suffix
+ - Test helpers are in &#96;test-helpers.js&#96;
+ - Main test runner is &#96;run-tests.js&#96;
+ - Tests are &quot;guardrail&quot; style - focused on invariants, not comprehensive coverage
+ 
+ ## File Naming Conventions
+ 
+ ### JavaScript Files
+ 
+ - **kebab-case** for all file names: &#96;auth-ui.js&#96;, &#96;timer-service.js&#96;
+ - **Descriptive names** that indicate purpose: &#96;dom-elements.js&#96;, &#96;state-manager.js&#96;
+ - **Suffixes** for clarity:
+   - &#96;-ui.js&#96; for UI handlers
+   - &#96;-service.js&#96; for service layer code
+   - &#96;.test.js&#96; for test files
+ 
+ ### Domain Index Files
+ 
+ - Each domain has an &#96;index.js&#96; that exports the public API
+ - Pattern: &#96;src/client/domains/{domain}/index.js&#96;
+ - Re-exports from domain implementation files
+ 
+ ## Directory Organization Principles
+ 
+ 1. **Domain-Driven** - Code is organized by business domain/feature
+ 2. **Separation of Concerns** - Client, server, and shared code are clearly separated
+ 3. **Public API Pattern** - Each domain exposes a clean public API via &#96;index.js&#96;
+ 4. **Co-location** - Related code is kept together (e.g., domain utils in domain folders)
+ 
+ ## Inconsistencies and Notes
+ 
+ ### Current Inconsistencies
+ 
+ 1. **Type File Locations** - Some types are in &#96;src/shared/domains/&#96;, some in &#96;src/shared/types/&#96;. The pattern is:
+    - Domain-specific types: &#96;src/shared/domains/{domain}/types.js&#96;
+    - Global types: &#96;src/shared/types/{category}.js&#96;
+ 
+ 2. **State Location** - &#96;src/client/state/app-state.js&#96; contains runtime state (client-only), but types are in &#96;src/shared/types/state.js&#96;. This is intentional - types are shared, implementation is client-only.
+ 
+ 3. **Utils Organization** - Some utilities are in &#96;src/client/utils/&#96;, some in &#96;src/shared/utils/&#96;. The distinction:
+    - Client utils: Use browser APIs (DOM, localStorage)
+    - Shared utils: Pure functions, no browser dependencies
+ 
+ ### Migration Notes
+ 
+ - The project is transitioning from a flat structure to a domain-driven structure
+ - Some legacy code may still exist in non-standard locations
+ - New code should follow these conventions strictly
+ 
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="write">

<details><summary>Tool use: **code_edit** • Edit file: conventions/naming-conventions.md</summary>

**Chunk 1**
Lines added: 187, lines removed: 1

```diff
@@ -1,1 +1,187 @@
- 
+ # Naming Conventions
+ 
+ This document describes the naming conventions used throughout the Better Life project.
+ 
+ ## File Names
+ 
+ ### JavaScript Files
+ 
+ - **kebab-case** for all file names
+ - Examples: &#96;auth-ui.js&#96;, &#96;timer-service.js&#96;, &#96;dom-elements.js&#96;
+ - Descriptive names that indicate purpose
+ - Suffixes for clarity:
+   - &#96;-ui.js&#96; - UI handlers and DOM manipulation
+   - &#96;-service.js&#96; - Service layer code
+   - &#96;.test.js&#96; - Test files
+ 
+ ### Type Definition Files
+ 
+ - Named &#96;types.js&#96; within domain directories
+ - Pattern: &#96;src/shared/domains/{domain}/types.js&#96;
+ - Global types in &#96;src/shared/types/{category}.js&#96;
+ 
+ ### Index Files
+ 
+ - Always named &#96;index.js&#96;
+ - Used for public API exports in domain modules
+ 
+ ## Variable Names
+ 
+ ### camelCase
+ 
+ - **Functions**: &#96;initTimer()&#96;, &#96;handleSignUp()&#96;, &#96;getDOMElements()&#96;
+ - **Variables**: &#96;currentTimer&#96;, &#96;isTimerRunning&#96;, &#96;timerInterval&#96;
+ - **Constants** (module-level): &#96;cachedElements&#96;, &#96;supabaseInitialized&#96;
+ 
+ ### UPPER_SNAKE_CASE
+ 
+ - **True constants** (never reassigned, exported):
+   - &#96;ERROR_SEVERITY.CRITICAL&#96;
+   - &#96;STORAGE_KEYS.TIMER_DURATION&#96;
+   - &#96;CSS_CLASSES.HIDDEN&#96;
+   - &#96;TIMER.DEFAULT_DURATION&#96;
+ 
+ ### Descriptive Names
+ 
+ - Use full words, not abbreviations (except well-known ones)
+ - Good: &#96;timerDuration&#96;, &#96;isAuthenticated&#96;, &#96;currentUser&#96;
+ - Avoid: &#96;td&#96;, &#96;auth&#96;, &#96;usr&#96;
+ 
+ ## Function Names
+ 
+ ### Prefixes for Clarity
+ 
+ - **&#96;init*&#96;** - Initialization functions: &#96;initTimer()&#96;, &#96;initNavigation()&#96;, &#96;initAuth()&#96;
+ - **&#96;handle*&#96;** - Event handlers: &#96;handleSignUp()&#96;, &#96;handleStartTimerClick()&#96;
+ - **&#96;get*&#96;** - Getters/accessors: &#96;getState()&#96;, &#96;getDOMElements()&#96;, &#96;getTimerDuration()&#96;
+ - **&#96;set*&#96;** - Setters: &#96;setState()&#96;, &#96;setTimerDuration()&#96;, &#96;setCurrentTimer()&#96;
+ - **&#96;show*&#96;** - Display/show functions: &#96;showPage()&#96;, &#96;showAuthForm()&#96;, &#96;showAuthMessage()&#96;
+ - **&#96;update*&#96;** - Update functions: &#96;updateStreak()&#96;, &#96;updateTimerDisplay()&#96;
+ - **&#96;reset*&#96;** - Reset functions: &#96;resetTimerState()&#96;, &#96;resetTimerDisplay()&#96;
+ - **&#96;with*&#96;** - Wrapper/higher-order functions: &#96;withErrorHandling()&#96;, &#96;withAsyncErrorHandling()&#96;
+ - **&#96;safe*&#96;** - Safe/null-checking functions: &#96;safeExecute()&#96;, &#96;safeGetElementById()&#96;
+ 
+ ### Async Functions
+ 
+ - No special naming for async functions
+ - Use descriptive names that indicate async behavior in documentation
+ - Example: &#96;signUpWithEmail()&#96; is async but doesn&#39;t need &#96;async&#96; prefix
+ 
+ ## Type Names
+ 
+ ### JSDoc Type Definitions
+ 
+ - **PascalCase** for type names
+ - Examples: &#96;AuthResult&#96;, &#96;AppState&#96;, &#96;DOMElements&#96;, &#96;APIResponse&#96;
+ - Descriptive and specific: &#96;AuthStateChangedEventDetail&#96;, &#96;SuccessResponse&#96;
+ 
+ ### Type Parameters
+ 
+ - Single uppercase letters for generics: &#96;APIResponse&lt;T&gt;&#96;, &#96;SuccessResponse&lt;T&gt;&#96;
+ 
+ ## DOM Element IDs and Classes
+ 
+ ### IDs
+ 
+ - **kebab-case** with descriptive prefixes
+ - Pattern: &#96;{element-type}-{purpose}&#96;
+ - Examples:
+   - &#96;btn-yes&#96;, &#96;btn-start-timer&#96;, &#96;btn-signup-submit&#96;
+   - &#96;timer-display&#96;, &#96;timer-intro&#96;, &#96;circle-timer&#96;
+   - &#96;auth-forms&#96;, &#96;signup-form&#96;, &#96;signin-form&#96;
+   - &#96;modal-overlay&#96;, &#96;modal-body&#96;, &#96;close-modal&#96;
+ 
+ ### CSS Classes
+ 
+ - **kebab-case**
+ - Semantic names: &#96;hidden&#96;, &#96;fade-in&#96;, &#96;fade-out&#96;, &#96;active-page&#96;
+ - Utility classes: &#96;auth-btn&#96;, &#96;primary&#96;, &#96;full-width&#96;
+ - State classes: &#96;dragging&#96;, &#96;show&#96;, &#96;scrollable&#96;
+ 
+ ## Module Exports
+ 
+ ### Named Exports (Preferred)
+ 
+ - Use named exports for most functions and constants
+ - Examples:
+   &#96;&#96;&#96;javascript
+   export function initTimer() { }
+   export const ERROR_SEVERITY = { };
+   &#96;&#96;&#96;
+ 
+ ### Default Exports
+ 
+ - Avoid default exports (except for classes or major components)
+ - Current pattern: No default exports in use
+ 
+ ## Constants Organization
+ 
+ ### Object-Based Constants
+ 
+ - Group related constants in objects
+ - Examples:
+   &#96;&#96;&#96;javascript
+   export const ERROR_SEVERITY = {
+       CRITICAL: &#39;critical&#39;,
+       ERROR: &#39;error&#39;,
+       WARNING: &#39;warning&#39;
+   };
+   
+   export const STORAGE_KEYS = {
+       TIMER_DURATION: &#39;bl_timerDuration&#39;,
+       DARK_MODE: &#39;bl_darkMode&#39;
+   };
+   &#96;&#96;&#96;
+ 
+ ### Access Pattern
+ 
+ - Access via object property: &#96;ERROR_SEVERITY.CRITICAL&#96;
+ - Destructure when importing: &#96;const { ERROR_SEVERITY } = ...&#96;
+ 
+ ## State Properties
+ 
+ ### State Object Properties
+ 
+ - **camelCase** for state properties
+ - Examples: &#96;timerDuration&#96;, &#96;currentTimer&#96;, &#96;isTimerRunning&#96;, &#96;darkMode&#96;
+ - Boolean properties prefixed with &#96;is*&#96;, &#96;has*&#96;, or &#96;was*&#96;: &#96;isTimerRunning&#96;, &#96;menuTitleHasBeenDismissed&#96;, &#96;wasDragged&#96;
+ 
+ ## Error Handling
+ 
+ ### Error Context Properties
+ 
+ - Use &#96;module&#96; and &#96;function&#96; in error context
+ - Examples:
+   &#96;&#96;&#96;javascript
+   handleError(error, {
+       context: { module: &#39;auth-ui.js&#39;, function: &#39;handleSignUp&#39; }
+   });
+   &#96;&#96;&#96;
+ 
+ ## LocalStorage Keys
+ 
+ ### Prefix Pattern
+ 
+ - All keys prefixed with &#96;bl_&#96; (Better Life)
+ - Examples: &#96;bl_timerDuration&#96;, &#96;bl_darkMode&#96;, &#96;bl_fontFamily&#96;, &#96;bl_lastDate&#96;
+ - Defined in &#96;STORAGE_KEYS&#96; constant object
+ 
+ ## Inconsistencies and Notes
+ 
+ ### Current Inconsistencies
+ 
+ 1. **Module Registry** - Uses &#96;moduleRegistry&#96; (camelCase) as a singleton instance name. This is acceptable for singleton instances.
+ 
+ 2. **State Object** - The state object itself is named &#96;state&#96; (lowercase). This is a special case for the main state object.
+ 
+ 3. **Window Fallbacks** - Some legacy code may still use &#96;window.*&#96; patterns. New code should use module imports and the module registry.
+ 
+ 4. **Function Naming** - Some functions don&#39;t follow the prefix pattern (e.g., &#96;finishSession()&#96; instead of &#96;handleFinishSession()&#96;). This is acceptable for domain-specific functions where the context is clear.
+ 
+ ### Best Practices
+ 
+ 1. **Be Consistent** - Once you choose a naming pattern, stick with it throughout the file/module
+ 2. **Be Descriptive** - Names should clearly indicate purpose
+ 3. **Follow Established Patterns** - Match existing code in the same domain
+ 4. **Document Exceptions** - If you must deviate, document why
+ 
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="write">

<details><summary>Tool use: **code_edit** • Edit file: conventions/error-handling.md</summary>

**Chunk 1**
Lines added: 284, lines removed: 1

```diff
@@ -1,1 +1,284 @@
- 
+ # Error Handling Conventions
+ 
+ This document describes the standardized error handling patterns used throughout the Better Life project.
+ 
+ ## Error Handling Module
+ 
+ All error handling goes through the centralized error handler in &#96;src/shared/utils/error-handler.js&#96;.
+ 
+ ### Import Pattern
+ 
+ &#96;&#96;&#96;javascript
+ import { handleError, withAsyncErrorHandling, ERROR_SEVERITY } from &#39;../../../shared/utils/error-handler.js&#39;;
+ &#96;&#96;&#96;
+ 
+ ## Error Severity Levels
+ 
+ ### Defined Severities
+ 
+ &#96;&#96;&#96;javascript
+ export const ERROR_SEVERITY = {
+     CRITICAL: &#39;critical&#39;,  // Breaks functionality
+     ERROR: &#39;error&#39;,        // Affects functionality but doesn&#39;t break app
+     WARNING: &#39;warning&#39;,    // Non-critical issues
+     INFO: &#39;info&#39;           // Debugging information
+ };
+ &#96;&#96;&#96;
+ 
+ ### Usage Guidelines
+ 
+ - **CRITICAL**: Use when the application cannot continue functioning
+   - Example: Failed to initialize core modules
+ - **ERROR**: Use for errors that affect functionality but allow the app to continue
+   - Example: API call failed, but app can work offline
+ - **WARNING**: Use for non-critical issues that should be noted
+   - Example: Optional feature failed to load
+ - **INFO**: Use for debugging and informational messages
+   - Example: State change notifications
+ 
+ ## Error Handling Functions
+ 
+ ### &#96;handleError()&#96;
+ 
+ Primary function for logging errors with context.
+ 
+ &#96;&#96;&#96;javascript
+ handleError(error, {
+     severity: ERROR_SEVERITY.ERROR,
+     context: { module: &#39;auth-ui.js&#39;, function: &#39;handleSignUp&#39; },
+     onError: (error, context) =&gt; { /* custom handler */ },
+     silent: false
+ });
+ &#96;&#96;&#96;
+ 
+ **Parameters:**
+ - &#96;error&#96; - Error object or error message string
+ - &#96;options.severity&#96; - Error severity (default: &#96;ERROR&#96;)
+ - &#96;options.context&#96; - Context object with &#96;module&#96; and &#96;function&#96; properties
+ - &#96;options.onError&#96; - Optional callback function
+ - &#96;options.silent&#96; - If true, don&#39;t log to console (default: false)
+ 
+ ### &#96;withErrorHandling()&#96;
+ 
+ Wraps a synchronous function with error handling.
+ 
+ &#96;&#96;&#96;javascript
+ export const myFunction = withErrorHandling(function() {
+     // function body
+ }, {
+     functionName: &#39;myFunction&#39;,
+     module: &#39;my-module.js&#39;,
+     defaultReturn: null,
+     onError: (error) =&gt; { /* custom handler */ }
+ });
+ &#96;&#96;&#96;
+ 
+ ### &#96;withAsyncErrorHandling()&#96;
+ 
+ Wraps an async function with error handling.
+ 
+ &#96;&#96;&#96;javascript
+ export const handleSignUp = withAsyncErrorHandling(async function() {
+     // async function body
+ }, {
+     functionName: &#39;handleSignUp&#39;,
+     module: &#39;auth-ui.js&#39;
+ });
+ &#96;&#96;&#96;
+ 
+ **Common Pattern:**
+ - Export wrapped functions directly
+ - Provide &#96;functionName&#96; and &#96;module&#96; in options
+ - Let the wrapper handle all error logging
+ 
+ ### &#96;safeExecute()&#96; and &#96;safeExecuteAsync()&#96;
+ 
+ Execute functions with error handling, returning a default value on error.
+ 
+ &#96;&#96;&#96;javascript
+ const result = safeExecute(() =&gt; {
+     return riskyOperation();
+ }, defaultValue, { module: &#39;my-module.js&#39;, function: &#39;myFunction&#39; });
+ &#96;&#96;&#96;
+ 
+ ## Error Context
+ 
+ ### Standard Context Properties
+ 
+ Always include:
+ - &#96;module&#96; - The file/module where the error occurred
+ - &#96;function&#96; - The function name where the error occurred
+ 
+ Optional:
+ - &#96;data&#96; - Additional context data (e.g., &#96;{ property: &#39;timerDuration&#39; }&#96;)
+ 
+ ### Example Context Objects
+ 
+ &#96;&#96;&#96;javascript
+ // Standard context
+ { module: &#39;auth-ui.js&#39;, function: &#39;handleSignUp&#39; }
+ 
+ // With additional data
+ { 
+     module: &#39;state-manager.js&#39;, 
+     function: &#39;setState&#39;, 
+     data: { property: &#39;timerDuration&#39;, expectedType: &#39;number&#39;, actualType: &#39;string&#39; } 
+ }
+ &#96;&#96;&#96;
+ 
+ ## Error Handling Patterns
+ 
+ ### Pattern 1: Wrapped Function Export
+ 
+ &#96;&#96;&#96;javascript
+ export const handleSignUp = withAsyncErrorHandling(async function() {
+     // Implementation
+     if (error) {
+         showAuthMessage(&#39;Error message&#39;, true);
+         return;
+     }
+     // Success path
+ }, {
+     functionName: &#39;handleSignUp&#39;,
+     module: &#39;auth-ui.js&#39;
+ });
+ &#96;&#96;&#96;
+ 
+ ### Pattern 2: Try-Catch with handleError
+ 
+ &#96;&#96;&#96;javascript
+ export async function signUpWithEmail(email, password) {
+     try {
+         const { data, error } = await supabase.auth.signUp({ email, password });
+         if (error) throw error;
+         return { success: true, data: data.user };
+     } catch (error) {
+         handleError(error, {
+             severity: ERROR_SEVERITY.ERROR,
+             context: { module: &#39;supabase-client.js&#39;, function: &#39;signUpWithEmail&#39; }
+         });
+         return { success: false, error: error.message };
+     }
+ }
+ &#96;&#96;&#96;
+ 
+ ### Pattern 3: Null Checking with Error Logging
+ 
+ &#96;&#96;&#96;javascript
+ function safeGetElementById(id, required = false) {
+     const element = document.getElementById(id);
+     if (required &amp;&amp; !element) {
+         handleError(&#96;Required DOM element not found: ${id}&#96;, {
+             severity: ERROR_SEVERITY.ERROR,
+             context: { module: &#39;dom-elements.js&#39;, elementId: id }
+         });
+     }
+     return element;
+ }
+ &#96;&#96;&#96;
+ 
+ ## API Response Error Pattern
+ 
+ ### Standard API Response Format
+ 
+ All API functions return &#96;APIResponse&lt;T&gt;&#96;:
+ 
+ &#96;&#96;&#96;javascript
+ // Success
+ { success: true, data: {...}, message?: string }
+ 
+ // Error
+ { success: false, error: string }
+ &#96;&#96;&#96;
+ 
+ ### Error Handling in API Functions
+ 
+ &#96;&#96;&#96;javascript
+ export async function signUpWithEmail(email, password) {
+     try {
+         // API call
+         const { data, error } = await supabase.auth.signUp({ email, password });
+         if (error) throw error;
+         
+         return { success: true, data: data.user, message: &#39;Account created!&#39; };
+     } catch (error) {
+         handleError(error, {
+             severity: ERROR_SEVERITY.ERROR,
+             context: { module: &#39;supabase-client.js&#39;, function: &#39;signUpWithEmail&#39; }
+         });
+         return { success: false, error: error.message };
+     }
+ }
+ &#96;&#96;&#96;
+ 
+ ## Error Recovery
+ 
+ ### Graceful Degradation
+ 
+ When errors occur, provide fallbacks:
+ 
+ &#96;&#96;&#96;javascript
+ // Try to load Supabase, but continue if it fails
+ await withAsyncErrorHandling(
+     async () =&gt; {
+         const supabaseModule = await import(&#39;./services/supabase-client.js&#39;);
+         if (supabaseModule.initAuth) {
+             await supabaseModule.initAuth();
+         }
+     },
+     {
+         functionName: &#39;initAuth&#39;,
+         module: &#39;app.js&#39;,
+         onError: () =&gt; {
+             handleError(&#39;Failed to initialize auth (continuing without it)&#39;, {
+                 severity: ERROR_SEVERITY.WARNING,
+                 context: { module: &#39;app.js&#39;, function: &#39;initAuth&#39; },
+                 silent: false
+             });
+         }
+     }
+ )();
+ &#96;&#96;&#96;
+ 
+ ## Console Logging
+ 
+ ### Severity-Based Logging
+ 
+ The error handler automatically logs based on severity:
+ - &#96;CRITICAL&#96; → &#96;console.error()&#96; with stack trace
+ - &#96;ERROR&#96; → &#96;console.error()&#96; with stack trace
+ - &#96;WARNING&#96; → &#96;console.warn()&#96;
+ - &#96;INFO&#96; → &#96;console.info()&#96;
+ 
+ ### Log Format
+ 
+ &#96;&#96;&#96;
+ [SEVERITY] [Module: module.js, Function: functionName] Error message
+ &#96;&#96;&#96;
+ 
+ ## Inconsistencies and Notes
+ 
+ ### Current Inconsistencies
+ 
+ 1. **Direct Console Logging** - Some code may still use &#96;console.log()&#96; directly. These should be migrated to use &#96;handleError()&#96; with appropriate severity.
+ 
+ 2. **Error Context** - Not all error handling includes full context. Best practice is to always include &#96;module&#96; and &#96;function&#96;.
+ 
+ 3. **Error Recovery** - Some functions don&#39;t provide graceful degradation. Consider adding fallbacks where appropriate.
+ 
+ 4. **Silent Errors** - The &#96;silent&#96; option is rarely used. Consider when errors should be logged vs. handled silently.
+ 
+ ### Best Practices
+ 
+ 1. **Always Use Error Handler** - Don&#39;t use &#96;console.error()&#96; directly
+ 2. **Provide Context** - Always include &#96;module&#96; and &#96;function&#96; in context
+ 3. **Choose Appropriate Severity** - Use the right severity level
+ 4. **Handle Errors Gracefully** - Provide fallbacks when possible
+ 5. **Return Error Responses** - API functions should return error responses, not throw
+ 
+ ### Migration Notes
+ 
+ - Legacy code may still use try-catch without &#96;handleError()&#96;
+ - Some functions may throw errors instead of returning error responses
+ - New code should follow these patterns strictly
+ 
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="write">

<details><summary>Tool use: **code_edit** • Edit file: conventions/imports-and-dependencies.md</summary>

**Chunk 1**
Lines added: 250, lines removed: 1

```diff
@@ -1,1 +1,250 @@
- 
+ # Imports and Dependencies Conventions
+ 
+ This document describes the import patterns and dependency management conventions used in the Better Life project.
+ 
+ ## Module System
+ 
+ The project uses **ES6 modules** (&#96;import&#96;/&#96;export&#96;) exclusively. All JavaScript files are ES modules.
+ 
+ ### Module Type Declaration
+ 
+ All modules are ES modules (no CommonJS). The project uses:
+ - &#96;package.json&#96; with &#96;&quot;type&quot;: &quot;module&quot;&#96;
+ - &#96;.js&#96; files with ES6 import/export syntax
+ - No &#96;.mjs&#96; extension needed
+ 
+ ## Import Patterns
+ 
+ ### Import Order
+ 
+ Imports should be organized in this order:
+ 
+ 1. **External dependencies** (third-party libraries)
+ 2. **Shared utilities and constants**
+ 3. **Type imports** (JSDoc typedefs)
+ 4. **Domain modules**
+ 5. **Local utilities** (same directory level)
+ 
+ ### Example Import Order
+ 
+ &#96;&#96;&#96;javascript
+ // 1. External dependencies
+ import { createClient } from &#39;https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm&#39;;
+ 
+ // 2. Shared utilities and constants
+ import { handleError, ERROR_SEVERITY } from &#39;../../../shared/utils/error-handler.js&#39;;
+ import { STORAGE_KEYS, TIMER } from &#39;../../../shared/constants.js&#39;;
+ 
+ // 3. Type imports (JSDoc - no runtime import needed, just for documentation)
+ /**
+  * @typedef {import(&#39;../../../shared/domains/auth/types.js&#39;).AuthResult} AuthResult
+  */
+ 
+ // 4. Domain modules
+ import { openModal, closeModal } from &#39;../navigation/modal.js&#39;;
+ import { getState, setState } from &#39;../../state/app-state.js&#39;;
+ 
+ // 5. Local utilities
+ import { getDOMElements } from &#39;../../utils/dom-elements.js&#39;;
+ &#96;&#96;&#96;
+ 
+ ## Import Styles
+ 
+ ### Named Imports (Preferred)
+ 
+ &#96;&#96;&#96;javascript
+ import { initTimer, handleStartTimerClick } from &#39;./domains/sessions/index.js&#39;;
+ import { ERROR_SEVERITY, STORAGE_KEYS } from &#39;../../shared/constants.js&#39;;
+ &#96;&#96;&#96;
+ 
+ ### Namespace Imports
+ 
+ Use when importing many items from a module:
+ 
+ &#96;&#96;&#96;javascript
+ import * as supabaseModule from &#39;../../services/supabase-client.js&#39;;
+ // Usage: supabaseModule.signUpWithEmail()
+ &#96;&#96;&#96;
+ 
+ ### Default Imports
+ 
+ **Avoid default exports** - the project uses named exports exclusively.
+ 
+ ### Dynamic Imports
+ 
+ Use for optional dependencies or code splitting:
+ 
+ &#96;&#96;&#96;javascript
+ // Lazy load optional module
+ const supabaseModule = await import(&#39;./services/supabase-client.js&#39;);
+ if (supabaseModule.initAuth) {
+     await supabaseModule.initAuth();
+ }
+ &#96;&#96;&#96;
+ 
+ ## Path Conventions
+ 
+ ### Relative Paths
+ 
+ Use relative paths for imports within the project:
+ 
+ &#96;&#96;&#96;javascript
+ // Same directory
+ import { helper } from &#39;./helper.js&#39;;
+ 
+ // Parent directory
+ import { util } from &#39;../util.js&#39;;
+ 
+ // Multiple levels
+ import { constant } from &#39;../../../shared/constants.js&#39;;
+ &#96;&#96;&#96;
+ 
+ ### Path Depth Guidelines
+ 
+ - **1-2 levels**: Common (same domain or immediate parent)
+ - **3+ levels**: Acceptable but consider if structure could be improved
+ - **Absolute paths**: Not used (no path aliases configured)
+ 
+ ### Common Import Paths
+ 
+ &#96;&#96;&#96;javascript
+ // From client domain to shared
+ import { ... } from &#39;../../../shared/utils/error-handler.js&#39;;
+ import { ... } from &#39;../../../shared/constants.js&#39;;
+ 
+ // From client domain to another domain
+ import { ... } from &#39;../navigation/modal.js&#39;;
+ 
+ // From client domain to utils
+ import { ... } from &#39;../../utils/dom-elements.js&#39;;
+ 
+ // From client domain to state
+ import { ... } from &#39;../../state/app-state.js&#39;;
+ &#96;&#96;&#96;
+ 
+ ## Dependency Management
+ 
+ ### Module Registry Pattern
+ 
+ For cross-module dependencies that can&#39;t use direct imports, use the module registry:
+ 
+ &#96;&#96;&#96;javascript
+ // Register a dependency
+ import { moduleRegistry } from &#39;../../utils/module-registry.js&#39;;
+ moduleRegistry.register(&#39;finishSession&#39;, finishSession);
+ 
+ // Access a dependency
+ const finishSession = moduleRegistry.get(&#39;finishSession&#39;);
+ &#96;&#96;&#96;
+ 
+ ### When to Use Module Registry
+ 
+ - Functions that need to be called from inline scripts (temporary)
+ - Circular dependency workarounds
+ - Dynamic dependencies that may not be loaded yet
+ 
+ ### When to Use Direct Imports
+ 
+ - **Preferred**: Always use direct imports when possible
+ - Static dependencies should always use direct imports
+ - Same-domain dependencies should use direct imports
+ 
+ ## External Dependencies
+ 
+ ### CDN Imports
+ 
+ Some dependencies are loaded from CDN (e.g., Supabase):
+ 
+ &#96;&#96;&#96;javascript
+ const { createClient } = await import(&#39;https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm&#39;);
+ &#96;&#96;&#96;
+ 
+ ### npm Packages
+ 
+ Dependencies listed in &#96;package.json&#96;:
+ 
+ &#96;&#96;&#96;json
+ {
+   &quot;dependencies&quot;: {
+     &quot;@supabase/supabase-js&quot;: &quot;^2.86.0&quot;
+   }
+ }
+ &#96;&#96;&#96;
+ 
+ **Note**: Currently, Supabase is loaded from CDN at runtime rather than bundled. This is a temporary pattern.
+ 
+ ## Type Imports (JSDoc)
+ 
+ ### Typedef Imports
+ 
+ Type definitions are imported using JSDoc comments (no runtime import):
+ 
+ &#96;&#96;&#96;javascript
+ /**
+  * @typedef {import(&#39;../../../shared/domains/auth/types.js&#39;).AuthFormType} AuthFormType
+  * @typedef {import(&#39;../../../shared/types/api.js&#39;).APIResponse} APIResponse
+  */
+ &#96;&#96;&#96;
+ 
+ ### Type Import Pattern
+ 
+ &#96;&#96;&#96;javascript
+ /**
+  * @typedef {import(&#39;../../path/to/types.js&#39;).TypeName} TypeName
+  */
+ &#96;&#96;&#96;
+ 
+ ## Circular Dependencies
+ 
+ ### Prevention
+ 
+ - Structure code to avoid circular dependencies
+ - Use the module registry for cases where circular dependencies are unavoidable
+ - Extract shared code to a common module
+ 
+ ### Detection
+ 
+ If you encounter circular dependency issues:
+ 1. Refactor to remove the circular dependency
+ 2. Use the module registry as a last resort
+ 3. Document why the circular dependency exists
+ 
+ ## Dependency Injection
+ 
+ ### Current Pattern
+ 
+ The project doesn&#39;t use formal dependency injection. Dependencies are:
+ - Imported directly (preferred)
+ - Accessed via module registry (when needed)
+ - Passed as function parameters (when appropriate)
+ 
+ ## Inconsistencies and Notes
+ 
+ ### Current Inconsistencies
+ 
+ 1. **Window Fallbacks** - Some code still checks &#96;window.*&#96; for backward compatibility:
+    &#96;&#96;&#96;javascript
+    const renderSettings = moduleRegistry.get(&#39;renderSettingsModal&#39;) || window.renderSettingsModal;
+    &#96;&#96;&#96;
+    This is temporary during migration.
+ 
+ 2. **Dynamic Imports** - Some modules use dynamic imports for optional dependencies. This is acceptable but should be documented.
+ 
+ 3. **CDN vs npm** - Supabase is loaded from CDN rather than bundled. This may change in the future.
+ 
+ 4. **Path Length** - Some imports have deep relative paths (3+ levels). Consider if structure could be improved.
+ 
+ ### Best Practices
+ 
+ 1. **Use Named Exports** - Always use named exports, avoid default exports
+ 2. **Organize Imports** - Follow the import order convention
+ 3. **Prefer Direct Imports** - Use direct imports over module registry when possible
+ 4. **Document Type Imports** - Use JSDoc typedef imports for type information
+ 5. **Avoid Circular Dependencies** - Structure code to prevent circular dependencies
+ 
+ ### Migration Notes
+ 
+ - Legacy code may still use &#96;window.*&#96; patterns
+ - Some modules may have inconsistent import styles
+ - New code should follow these conventions strictly
+ 
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="write">

<details><summary>Tool use: **code_edit** • Edit file: conventions/client-server-boundaries.md</summary>

**Chunk 1**
Lines added: 262, lines removed: 1

```diff
@@ -1,1 +1,262 @@
- 
+ # Client-Server Boundaries
+ 
+ This document describes the separation between client-side and server-side code in the Better Life project.
+ 
+ ## Project Architecture
+ 
+ The Better Life project is a **client-side JavaScript application** that runs entirely in the browser. It uses Supabase as a Backend-as-a-Service (BaaS) for authentication and data storage.
+ 
+ ### Key Characteristics
+ 
+ - **No Node.js server** - All application logic runs in the browser
+ - **Supabase BaaS** - Backend services provided by Supabase
+ - **Client-only code** - All JavaScript executes in the browser
+ - **Database schema** - Only server-side artifact is the SQL schema file
+ 
+ ## Directory Structure
+ 
+ ### Client Code (&#96;src/client/&#96;)
+ 
+ All code that runs in the browser:
+ 
+ &#96;&#96;&#96;
+ src/client/
+ ├── app.js                 # Main entry point
+ ├── domains/               # Domain modules (all client-side)
+ ├── services/              # External service clients (Supabase)
+ ├── state/                 # State management (browser runtime state)
+ └── utils/                 # Client utilities (DOM, localStorage)
+ &#96;&#96;&#96;
+ 
+ **Characteristics:**
+ - Uses browser APIs: &#96;document&#96;, &#96;window&#96;, &#96;localStorage&#96;, &#96;DOM&#96;
+ - Makes HTTP requests to Supabase
+ - Handles user interactions and UI updates
+ - Manages browser-based state
+ 
+ ### Server Code (&#96;src/server/&#96;)
+ 
+ Minimal server-side code:
+ 
+ &#96;&#96;&#96;
+ src/server/
+ └── database/
+     └── schema.sql         # PostgreSQL/Supabase database schema
+ &#96;&#96;&#96;
+ 
+ **Characteristics:**
+ - Only contains database schema definitions
+ - SQL file executed on Supabase server
+ - No runtime server code
+ 
+ ### Shared Code (&#96;src/shared/&#96;)
+ 
+ Code that could theoretically be used by both client and server:
+ 
+ &#96;&#96;&#96;
+ src/shared/
+ ├── types/                 # Type definitions (JSDoc)
+ ├── domains/               # Domain-specific types
+ ├── utils/                 # Shared utilities (pure functions)
+ └── constants.js          # Application constants
+ &#96;&#96;&#96;
+ 
+ **Characteristics:**
+ - Pure type definitions (no runtime code)
+ - Pure utility functions (no side effects)
+ - Constants and configuration
+ - Currently only used by client, but structured for potential server use
+ 
+ ## Code Classification
+ 
+ ### Client-Only Indicators
+ 
+ Code that uses these APIs is client-only:
+ - &#96;document.*&#96; - DOM manipulation
+ - &#96;window.*&#96; - Browser APIs
+ - &#96;localStorage.*&#96; - Browser storage
+ - &#96;HTMLElement&#96;, &#96;Event&#96;, etc. - DOM types
+ - Browser timers: &#96;setInterval&#96;, &#96;setTimeout&#96;
+ 
+ ### Server-Only Indicators
+ 
+ Currently, only:
+ - SQL files (&#96;.sql&#96;)
+ - Database schema definitions
+ 
+ ### Shared Code Indicators
+ 
+ Code that is:
+ - Pure functions (no side effects)
+ - Type definitions (JSDoc)
+ - Constants and configuration
+ - No browser or server APIs
+ 
+ ## API Boundaries
+ 
+ ### Supabase Client
+ 
+ The Supabase client (&#96;src/client/services/supabase-client.js&#96;) is client-side code that:
+ - Runs in the browser
+ - Makes HTTP requests to Supabase
+ - Handles authentication state
+ - Manages API calls
+ 
+ **Pattern:**
+ &#96;&#96;&#96;javascript
+ // Client-side code making API calls
+ export async function signUpWithEmail(email, password) {
+     const { data, error } = await supabase.auth.signUp({ email, password });
+     // Handle response
+ }
+ &#96;&#96;&#96;
+ 
+ ### API Response Pattern
+ 
+ All API functions return a standardized response:
+ 
+ &#96;&#96;&#96;javascript
+ // Success
+ { success: true, data: {...}, message?: string }
+ 
+ // Error
+ { success: false, error: string }
+ &#96;&#96;&#96;
+ 
+ This pattern allows client code to handle responses consistently.
+ 
+ ## State Management
+ 
+ ### Client State
+ 
+ State managed in &#96;src/client/state/&#96;:
+ - Browser runtime state (timers, UI state)
+ - Persisted to &#96;localStorage&#96;
+ - Not shared with server
+ 
+ ### Server State
+ 
+ No server-side state management exists. All state is:
+ - Client-side (browser)
+ - Persisted to Supabase (via API calls)
+ - Or stored in &#96;localStorage&#96;
+ 
+ ## Data Flow
+ 
+ ### Client to Server
+ 
+ 1. User action in browser
+ 2. Client code calls Supabase API
+ 3. Supabase handles request (authentication, database)
+ 4. Response returned to client
+ 5. Client updates UI/state
+ 
+ ### Server to Client
+ 
+ 1. Supabase provides real-time subscriptions (if used)
+ 2. Client listens for auth state changes
+ 3. Client updates UI based on server events
+ 
+ ## Authentication Flow
+ 
+ ### Client-Side Auth
+ 
+ Authentication is handled client-side:
+ - Supabase client runs in browser
+ - Auth state managed in browser
+ - Session stored by Supabase (cookies/localStorage)
+ - Auth state changes trigger browser events
+ 
+ **Pattern:**
+ &#96;&#96;&#96;javascript
+ // Client-side auth initialization
+ export async function initAuth() {
+     const { data: { session } } = await supabase.auth.getSession();
+     // Update client state
+     supabase.auth.onAuthStateChange((event, session) =&gt; {
+         // Handle auth state changes
+     });
+ }
+ &#96;&#96;&#96;
+ 
+ ## File Placement Rules
+ 
+ ### When to Place Code in &#96;src/client/&#96;
+ 
+ - Uses browser APIs (DOM, localStorage, window)
+ - Handles user interactions
+ - Manages UI state
+ - Makes API calls to external services
+ 
+ ### When to Place Code in &#96;src/shared/&#96;
+ 
+ - Pure functions (no side effects)
+ - Type definitions
+ - Constants and configuration
+ - Code that could be used by both client and server (theoretical)
+ 
+ ### When to Place Code in &#96;src/server/&#96;
+ 
+ - Database schema files
+ - Server configuration (if added in future)
+ - Server-side business logic (if added in future)
+ 
+ ## Import Boundaries
+ 
+ ### Client Code Imports
+ 
+ Client code can import:
+ - Other client code
+ - Shared code (types, constants, utilities)
+ - External libraries (Supabase, etc.)
+ 
+ Client code should NOT import:
+ - Server code (currently none exists)
+ 
+ ### Shared Code Imports
+ 
+ Shared code should NOT import:
+ - Client-specific code
+ - Server-specific code
+ - Browser APIs
+ - Node.js APIs
+ 
+ Shared code can import:
+ - Other shared code
+ - External libraries (only if pure/universal)
+ 
+ ## Testing Boundaries
+ 
+ ### Client Tests
+ 
+ Tests for client code run in:
+ - Browser environment (for DOM tests)
+ - Node.js environment (for unit tests with mocks)
+ 
+ ### Server Tests
+ 
+ Currently no server tests exist (no server code).
+ 
+ ## Inconsistencies and Notes
+ 
+ ### Current State
+ 
+ 1. **Pure Client Application** - No server-side application code exists
+ 2. **Supabase as BaaS** - All backend functionality provided by Supabase
+ 3. **Shared Code Structure** - Types and utilities structured as if server might exist, but currently only used by client
+ 
+ ### Migration Considerations
+ 
+ If a Node.js server is added in the future:
+ - Move business logic to server
+ - Keep UI logic in client
+ - Share types and utilities via &#96;src/shared/&#96;
+ - API layer would be server-side, client would call it
+ 
+ ### Best Practices
+ 
+ 1. **Clear Separation** - Keep client and server code clearly separated
+ 2. **Shared Types** - Use &#96;src/shared/&#96; for types that both sides need
+ 3. **API Boundaries** - Define clear API contracts between client and server
+ 4. **No Direct Database Access** - Client should never access database directly, only via API
+ 
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="write">

<details><summary>Tool use: **code_edit** • Edit file: conventions/testing-organization.md</summary>

**Chunk 1**
Lines added: 256, lines removed: 1

```diff
@@ -1,1 +1,256 @@
- 
+ # Testing Organization Conventions
+ 
+ This document describes the testing structure and patterns used in the Better Life project.
+ 
+ ## Test Philosophy
+ 
+ The project uses **&quot;guardrail tests&quot;** - lightweight tests that enforce critical invariants rather than comprehensive test coverage. These tests catch breaking changes and validate critical contracts.
+ 
+ ## Test Directory Structure
+ 
+ &#96;&#96;&#96;
+ tests/
+ ├── README.md                    # Test documentation
+ ├── run-tests.js                 # Main test runner
+ ├── test-helpers.js              # Test utilities and assertion library
+ ├── api-response-guards.test.js # API response shape validation
+ ├── utils-guards.test.js         # Utility function behavior checks
+ ├── guardrails.test.js           # State shape documentation
+ ├── state-manager.test.js        # State manager tests
+ ├── state-manager-test.html      # Browser-based state tests
+ ├── run-state-tests.js           # State test runner
+ └── *.test.js                    # Other test files
+ &#96;&#96;&#96;
+ 
+ ## Test File Naming
+ 
+ - **&#96;.test.js&#96;** suffix for all test files
+ - Descriptive names: &#96;api-response-guards.test.js&#96;, &#96;state-manager.test.js&#96;
+ - Group related tests: &#96;*-guards.test.js&#96; for guardrail tests
+ 
+ ## Test Runner
+ 
+ ### Main Test Runner
+ 
+ &#96;tests/run-tests.js&#96; - Runs all test files:
+ 
+ &#96;&#96;&#96;bash
+ npm test
+ # or
+ node tests/run-tests.js
+ &#96;&#96;&#96;
+ 
+ ### Test Helpers
+ 
+ &#96;tests/test-helpers.js&#96; - Minimal assertion library (no external dependencies):
+ 
+ &#96;&#96;&#96;javascript
+ // Test structure
+ describe(&#39;Test Suite&#39;, () =&gt; {
+     it(&#39;should do something&#39;, () =&gt; {
+         assert(condition, &#39;Error message&#39;);
+     });
+ });
+ &#96;&#96;&#96;
+ 
+ ## Test Types
+ 
+ ### Guardrail Tests
+ 
+ Tests that validate critical invariants:
+ 
+ 1. **API Response Shapes** - Ensures all API responses match &#96;APIResponse&lt;T&gt;&#96; type
+ 2. **Utility Functions** - Verifies critical utils behave correctly
+ 3. **State Shapes** - Documents expected state structure
+ 
+ ### Example Guardrail Test
+ 
+ &#96;&#96;&#96;javascript
+ describe(&#39;API Response Guards&#39;, () =&gt; {
+     it(&#39;validates success response shape&#39;, () =&gt; {
+         const response = { success: true, data: {} };
+         assert(response.success === true, &#39;Has success property&#39;);
+         assert(&#39;data&#39; in response, &#39;Has data property&#39;);
+     });
+     
+     it(&#39;validates error response shape&#39;, () =&gt; {
+         const response = { success: false, error: &#39;message&#39; };
+         assert(response.success === false, &#39;Has success property&#39;);
+         assert(&#39;error&#39; in response, &#39;Has error property&#39;);
+     });
+ });
+ &#96;&#96;&#96;
+ 
+ ## Test Organization
+ 
+ ### By Category
+ 
+ Tests are organized by what they guard:
+ 
+ - **API Tests** - API response validation
+ - **Utility Tests** - Utility function behavior
+ - **State Tests** - State management validation
+ - **Guardrail Tests** - General invariants
+ 
+ ### Test Structure
+ 
+ &#96;&#96;&#96;javascript
+ describe(&#39;Feature Name&#39;, () =&gt; {
+     it(&#39;should validate expected behavior&#39;, () =&gt; {
+         // Arrange
+         const input = ...;
+         
+         // Act
+         const result = functionUnderTest(input);
+         
+         // Assert
+         assert(result.hasExpectedProperty, &#39;Has expected property&#39;);
+     });
+ });
+ &#96;&#96;&#96;
+ 
+ ## Test Helpers
+ 
+ ### Assertion Functions
+ 
+ From &#96;test-helpers.js&#96;:
+ 
+ &#96;&#96;&#96;javascript
+ // Basic assertion
+ assert(condition, message);
+ 
+ // Equality check
+ assertEqual(actual, expected, message);
+ 
+ // Type check
+ assertType(value, expectedType, message);
+ &#96;&#96;&#96;
+ 
+ ### Test Utilities
+ 
+ - Minimal assertion library (no external dependencies)
+ - Simple test structure (&#96;describe&#96;, &#96;it&#96;, &#96;assert&#96;)
+ - Focus on shape/behavior validation, not implementation details
+ 
+ ## Browser Tests
+ 
+ ### State Manager Browser Tests
+ 
+ Some tests require browser environment:
+ 
+ - &#96;state-manager-test.html&#96; - Browser-based test page
+ - &#96;run-state-tests.js&#96; - Test runner for browser tests
+ - Tests DOM interactions and browser APIs
+ 
+ ### Running Browser Tests
+ 
+ &#96;&#96;&#96;bash
+ # Open in browser
+ open tests/state-manager-test.html
+ 
+ # Or use test runner
+ node tests/run-state-tests.js
+ &#96;&#96;&#96;
+ 
+ ## Test Coverage Philosophy
+ 
+ ### What to Test
+ 
+ - **Critical contracts** - API response shapes, type contracts
+ - **Utility functions** - Core utility behavior
+ - **State invariants** - State structure and behavior
+ - **Breaking changes** - Tests that catch regressions
+ 
+ ### What NOT to Test
+ 
+ - **Implementation details** - Don&#39;t test how, test what
+ - **UI rendering** - Not currently tested (may change)
+ - **Comprehensive coverage** - Not the goal (guardrails only)
+ 
+ ## Test Patterns
+ 
+ ### API Response Validation
+ 
+ &#96;&#96;&#96;javascript
+ describe(&#39;API Response Guards&#39;, () =&gt; {
+     it(&#39;validates all API responses match APIResponse&lt;T&gt;&#39;, () =&gt; {
+         // Test that API functions return correct shape
+     });
+ });
+ &#96;&#96;&#96;
+ 
+ ### Utility Function Tests
+ 
+ &#96;&#96;&#96;javascript
+ describe(&#39;Utility Guards&#39;, () =&gt; {
+     it(&#39;validates time formatting&#39;, () =&gt; {
+         const result = formatTime(600);
+         assert(result === &#39;10:00&#39;, &#39;Formats time correctly&#39;);
+     });
+ });
+ &#96;&#96;&#96;
+ 
+ ### State Shape Tests
+ 
+ &#96;&#96;&#96;javascript
+ describe(&#39;State Guards&#39;, () =&gt; {
+     it(&#39;validates state structure&#39;, () =&gt; {
+         const state = getStateObject();
+         assert(&#39;timerDuration&#39; in state, &#39;Has timerDuration&#39;);
+         assert(typeof state.timerDuration === &#39;number&#39;, &#39;timerDuration is number&#39;);
+     });
+ });
+ &#96;&#96;&#96;
+ 
+ ## Test Execution
+ 
+ ### Running Tests
+ 
+ &#96;&#96;&#96;bash
+ # Run all tests
+ npm test
+ 
+ # Run specific test file
+ node tests/api-response-guards.test.js
+ 
+ # Run browser tests
+ node tests/run-state-tests.js
+ &#96;&#96;&#96;
+ 
+ ### Test Output
+ 
+ Tests output:
+ - Test suite name
+ - Test case results (pass/fail)
+ - Error messages for failures
+ - Summary of results
+ 
+ ## Inconsistencies and Notes
+ 
+ ### Current State
+ 
+ 1. **Lightweight Testing** - Tests are guardrails, not comprehensive
+ 2. **No Test Framework** - Uses custom minimal test helpers
+ 3. **Browser Tests Separate** - Some tests require browser environment
+ 4. **Limited Coverage** - Only critical invariants are tested
+ 
+ ### Future Considerations
+ 
+ 1. **Test Framework** - May adopt a test framework (Jest, Mocha, etc.) in future
+ 2. **Coverage Expansion** - May add more comprehensive tests
+ 3. **UI Testing** - May add UI/component tests
+ 4. **Integration Tests** - May add integration tests for API flows
+ 
+ ### Best Practices
+ 
+ 1. **Keep Tests Simple** - Focus on invariants, not implementation
+ 2. **Document Contracts** - Tests should document expected behavior
+ 3. **Catch Breaking Changes** - Tests should fail when contracts break
+ 4. **No External Dependencies** - Test helpers are self-contained (for now)
+ 
+ ### Migration Notes
+ 
+ - Current tests are minimal and focused
+ - New tests should follow the guardrail pattern
+ - Consider adopting a test framework if tests grow
+ 
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="write">

<details><summary>Tool use: **code_edit** • Edit file: conventions/DOMAIN_STRUCTURE_PROPOSAL.md</summary>

**Chunk 1**
Lines added: 299, lines removed: 1

```diff
@@ -1,1 +1,299 @@
- 
+ # Domain Structure Proposal
+ 
+ This document describes the domain-driven design structure used in the Better Life project.
+ 
+ ## Domain Organization
+ 
+ The project is organized by **business domains** rather than technical layers. Each domain represents a cohesive area of functionality.
+ 
+ ## Current Domains
+ 
+ ### 1. Auth Domain (&#96;src/client/domains/auth/&#96;)
+ 
+ **Purpose**: User authentication and authorization
+ 
+ **Structure**:
+ &#96;&#96;&#96;
+ auth/
+ ├── auth-ui.js      # UI handlers for auth forms
+ └── index.js        # Public API exports
+ &#96;&#96;&#96;
+ 
+ **Shared Types**: &#96;src/shared/domains/auth/types.js&#96;
+ 
+ **Responsibilities**:
+ - Sign up, sign in, sign out
+ - Magic link authentication
+ - Password reset
+ - Auth state management
+ - Auth UI interactions
+ 
+ ### 2. Sessions Domain (&#96;src/client/domains/sessions/&#96;)
+ 
+ **Purpose**: Timer sessions and session management
+ 
+ **Structure**:
+ &#96;&#96;&#96;
+ sessions/
+ ├── timer.js           # Timer logic and controls
+ ├── timer-service.js   # Timer service layer
+ ├── streak.js          # Streak calculation
+ ├── index.js           # Public API exports
+ └── utils/             # Domain-specific utilities
+     ├── progress-ring.js
+     └── time-format.js
+ &#96;&#96;&#96;
+ 
+ **Shared Types**: &#96;src/shared/domains/sessions/types.js&#96;
+ 
+ **Responsibilities**:
+ - Timer countdown logic
+ - Timer display updates
+ - Progress ring visualization
+ - Streak tracking
+ - Session completion
+ 
+ ### 3. Navigation Domain (&#96;src/client/domains/navigation/&#96;)
+ 
+ **Purpose**: Page navigation and modal management
+ 
+ **Structure**:
+ &#96;&#96;&#96;
+ navigation/
+ ├── routing.js          # Page navigation
+ ├── modal.js            # Modal management
+ ├── menu-interactions.js # Menu UI interactions
+ └── index.js            # Public API exports
+ &#96;&#96;&#96;
+ 
+ **Shared Types**: None (UI-only domain)
+ 
+ **Responsibilities**:
+ - Page transitions
+ - Modal open/close
+ - Menu interactions
+ - Navigation state
+ 
+ ### 4. Reflection Domain (&#96;src/client/domains/reflection/&#96;)
+ 
+ **Purpose**: Reflection questions and responses
+ 
+ **Structure**:
+ &#96;&#96;&#96;
+ reflection/
+ ├── questions-ui.js    # Questions UI handlers
+ └── index.js           # Public API exports
+ &#96;&#96;&#96;
+ 
+ **Shared Types**: &#96;src/shared/domains/reflection/types.js&#96;
+ 
+ **Responsibilities**:
+ - Question flows
+ - Response collection
+ - Reflection UI interactions
+ 
+ ### 5. Users Domain (&#96;src/client/domains/users/&#96;)
+ 
+ **Purpose**: User data and preferences
+ 
+ **Structure**:
+ &#96;&#96;&#96;
+ users/
+ ├── data-persistence.js    # Data persistence (localStorage)
+ ├── data-migration.js      # Data migration utilities
+ ├── index.js               # Public API exports
+ └── preferences/           # User preferences subdomain
+     ├── fonts.js           # Font management
+     └── settings-ui.js     # Settings UI
+ &#96;&#96;&#96;
+ 
+ **Shared Types**: &#96;src/shared/domains/users/types.js&#96;
+ 
+ **Responsibilities**:
+ - User data persistence
+ - User preferences (dark mode, fonts)
+ - Settings UI
+ - Data migration
+ 
+ ### 6. Feedback Domain (&#96;src/client/domains/feedback/&#96;)
+ 
+ **Purpose**: User feedback collection
+ 
+ **Structure**:
+ &#96;&#96;&#96;
+ feedback/
+ └── index.js           # Public API (placeholder)
+ &#96;&#96;&#96;
+ 
+ **Shared Types**: &#96;src/shared/domains/feedback/types.js&#96;
+ 
+ **Responsibilities**:
+ - Feedback submission
+ - Feedback UI (currently in app.js)
+ 
+ ## Domain Structure Pattern
+ 
+ ### Standard Domain Structure
+ 
+ &#96;&#96;&#96;
+ {domain}/
+ ├── {domain}-ui.js     # UI handlers (if needed)
+ ├── {domain}-service.js # Service layer (if needed)
+ ├── index.js           # Public API exports
+ └── utils/             # Domain-specific utilities (optional)
+     └── *.js
+ &#96;&#96;&#96;
+ 
+ ### Public API Pattern
+ 
+ Each domain exports a clean public API via &#96;index.js&#96;:
+ 
+ &#96;&#96;&#96;javascript
+ /**
+  * {Domain} Domain - Public API
+  */
+ 
+ // Re-export public functions
+ export { function1, function2 } from &#39;./implementation.js&#39;;
+ export { function3 } from &#39;./other-file.js&#39;;
+ &#96;&#96;&#96;
+ 
+ ### Domain Types
+ 
+ Each domain has corresponding types in &#96;src/shared/domains/{domain}/types.js&#96;:
+ 
+ &#96;&#96;&#96;javascript
+ /**
+  * {Domain} Domain Types
+  */
+ 
+ /**
+  * @typedef {Object} DomainType
+  * @property {string} property
+  */
+ &#96;&#96;&#96;
+ 
+ ## Domain Principles
+ 
+ ### 1. Cohesion
+ 
+ All code related to a domain is kept together:
+ - UI handlers
+ - Business logic
+ - Domain-specific utilities
+ - Domain types
+ 
+ ### 2. Encapsulation
+ 
+ Domains expose only what&#39;s needed via public API:
+ - Other domains import from &#96;index.js&#96;
+ - Internal implementation is private
+ - Clear boundaries between domains
+ 
+ ### 3. Independence
+ 
+ Domains should be as independent as possible:
+ - Minimal cross-domain dependencies
+ - Shared code in &#96;src/shared/&#96;
+ - Domain-specific code in domain folder
+ 
+ ### 4. Single Responsibility
+ 
+ Each domain has a clear, single purpose:
+ - Auth: Authentication only
+ - Sessions: Timer sessions only
+ - Navigation: Navigation only
+ - etc.
+ 
+ ## Cross-Domain Communication
+ 
+ ### Direct Imports (Preferred)
+ 
+ Domains can import from other domains via their public API:
+ 
+ &#96;&#96;&#96;javascript
+ // In navigation domain
+ import { showPage } from &#39;../navigation/index.js&#39;;
+ &#96;&#96;&#96;
+ 
+ ### Module Registry (When Needed)
+ 
+ For dynamic dependencies or circular dependency workarounds:
+ 
+ &#96;&#96;&#96;javascript
+ // Register
+ moduleRegistry.register(&#39;finishSession&#39;, finishSession);
+ 
+ // Access
+ const finishSession = moduleRegistry.get(&#39;finishSession&#39;);
+ &#96;&#96;&#96;
+ 
+ ### Shared Code
+ 
+ Common functionality goes in &#96;src/shared/&#96;:
+ - Types
+ - Constants
+ - Utilities
+ - State types
+ 
+ ## Domain Boundaries
+ 
+ ### What Belongs in a Domain
+ 
+ - **Domain-specific logic** - Business rules for that domain
+ - **Domain UI** - UI handlers specific to that domain
+ - **Domain types** - Types specific to that domain
+ - **Domain utilities** - Utilities used only by that domain
+ 
+ ### What Belongs in Shared
+ 
+ - **Common types** - Types used by multiple domains
+ - **Common utilities** - Utilities used by multiple domains
+ - **Constants** - Application-wide constants
+ - **Error handling** - Shared error handling utilities
+ 
+ ### What Belongs in Client Utils
+ 
+ - **DOM utilities** - General DOM manipulation
+ - **Module registry** - Cross-module dependency management
+ - **Client-specific utilities** - Browser-specific helpers
+ 
+ ## Subdomains
+ 
+ Some domains have subdomains for nested features:
+ 
+ &#96;&#96;&#96;
+ users/
+ └── preferences/    # User preferences subdomain
+     ├── fonts.js
+     └── settings-ui.js
+ &#96;&#96;&#96;
+ 
+ **Pattern**: Use subdirectories for cohesive sub-features within a domain.
+ 
+ ## Inconsistencies and Notes
+ 
+ ### Current Inconsistencies
+ 
+ 1. **Feedback Domain** - Currently just a placeholder. Feedback UI is in &#96;app.js&#96;. Should be moved to feedback domain.
+ 
+ 2. **Domain Utils** - Not all domains have a &#96;utils/&#96; subdirectory. Only sessions domain currently has one.
+ 
+ 3. **Service Layer** - Only sessions domain has a &#96;-service.js&#96; file. Other domains may benefit from service layer separation.
+ 
+ 4. **UI Separation** - Some domains have &#96;-ui.js&#96; files, others don&#39;t. Pattern is not consistently applied.
+ 
+ ### Migration Notes
+ 
+ - Domains are being established gradually
+ - Some code may still be in non-domain locations
+ - New code should follow domain structure strictly
+ - Existing code should be migrated to appropriate domains
+ 
+ ### Best Practices
+ 
+ 1. **Start with Domain** - When adding new features, identify the domain first
+ 2. **Use Public API** - Always import from domain &#96;index.js&#96;, not internal files
+ 3. **Keep Domains Focused** - Don&#39;t mix concerns across domains
+ 4. **Extract Shared Code** - If code is used by multiple domains, move to &#96;src/shared/&#96;
+ 
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="write">

<details><summary>Tool use: **code_edit** • Edit file: conventions/DOMAIN_STRUCTURE_TREE.md</summary>

**Chunk 1**
Lines added: 191, lines removed: 1

```diff
@@ -1,1 +1,191 @@
- 
+ # Domain Structure Tree
+ 
+ Visual representation of the domain-driven structure in the Better Life project.
+ 
+ ## Complete Domain Structure
+ 
+ &#96;&#96;&#96;
+ src/
+ ├── client/
+ │   ├── domains/
+ │   │   ├── auth/
+ │   │   │   ├── auth-ui.js
+ │   │   │   └── index.js
+ │   │   │
+ │   │   ├── sessions/
+ │   │   │   ├── timer.js
+ │   │   │   ├── timer-service.js
+ │   │   │   ├── streak.js
+ │   │   │   ├── index.js
+ │   │   │   └── utils/
+ │   │   │       ├── progress-ring.js
+ │   │   │       └── time-format.js
+ │   │   │
+ │   │   ├── navigation/
+ │   │   │   ├── routing.js
+ │   │   │   ├── modal.js
+ │   │   │   ├── menu-interactions.js
+ │   │   │   └── index.js
+ │   │   │
+ │   │   ├── reflection/
+ │   │   │   ├── questions-ui.js
+ │   │   │   └── index.js
+ │   │   │
+ │   │   ├── users/
+ │   │   │   ├── data-persistence.js
+ │   │   │   ├── data-migration.js
+ │   │   │   ├── index.js
+ │   │   │   └── preferences/
+ │   │   │       ├── fonts.js
+ │   │   │       └── settings-ui.js
+ │   │   │
+ │   │   └── feedback/
+ │   │       └── index.js
+ │   │
+ │   ├── services/
+ │   │   └── supabase-client.js
+ │   │
+ │   ├── state/
+ │   │   ├── app-state.js
+ │   │   └── state-manager.js
+ │   │
+ │   └── utils/
+ │       ├── dom-elements.js
+ │       ├── dom-helpers.js
+ │       ├── button-handlers.js
+ │       └── module-registry.js
+ │
+ └── shared/
+     ├── types/
+     │   ├── api.js
+     │   ├── dom.js
+     │   └── state.js
+     │
+     ├── domains/
+     │   ├── auth/
+     │   │   └── types.js
+     │   ├── sessions/
+     │   │   └── types.js
+     │   ├── reflection/
+     │   │   └── types.js
+     │   ├── users/
+     │   │   └── types.js
+     │   └── feedback/
+     │       └── types.js
+     │
+     ├── utils/
+     │   ├── error-handler.js
+     │   ├── transitions.js
+     │   └── index.js
+     │
+     └── constants.js
+ &#96;&#96;&#96;
+ 
+ ## Domain Dependencies
+ 
+ ### Auth Domain
+ - **Depends on**: &#96;services/supabase-client.js&#96;, &#96;navigation/modal.js&#96;, &#96;utils/module-registry.js&#96;
+ - **Provides**: Authentication UI, auth state management
+ - **Types**: &#96;shared/domains/auth/types.js&#96;
+ 
+ ### Sessions Domain
+ - **Depends on**: &#96;state/app-state.js&#96;, &#96;utils/dom-elements.js&#96;, &#96;shared/constants.js&#96;
+ - **Provides**: Timer logic, streak tracking, session management
+ - **Types**: &#96;shared/domains/sessions/types.js&#96;
+ - **Sub-utilities**: &#96;utils/progress-ring.js&#96;, &#96;utils/time-format.js&#96;
+ 
+ ### Navigation Domain
+ - **Depends on**: &#96;utils/dom-elements.js&#96;, &#96;shared/constants.js&#96;
+ - **Provides**: Page routing, modal management, menu interactions
+ - **Types**: None (UI-only)
+ 
+ ### Reflection Domain
+ - **Depends on**: &#96;services/supabase-client.js&#96;, &#96;utils/dom-elements.js&#96;
+ - **Provides**: Questions UI, response collection
+ - **Types**: &#96;shared/domains/reflection/types.js&#96;
+ 
+ ### Users Domain
+ - **Depends on**: &#96;state/app-state.js&#96;, &#96;services/supabase-client.js&#96;, &#96;utils/dom-elements.js&#96;
+ - **Provides**: User data persistence, preferences management
+ - **Types**: &#96;shared/domains/users/types.js&#96;
+ - **Subdomain**: &#96;preferences/&#96; (fonts, settings)
+ 
+ ### Feedback Domain
+ - **Depends on**: &#96;services/supabase-client.js&#96; (via app.js)
+ - **Provides**: Feedback submission (currently minimal)
+ - **Types**: &#96;shared/domains/feedback/types.js&#96;
+ 
+ ## Shared Code Structure
+ 
+ ### Types (&#96;src/shared/types/&#96;)
+ - **api.js** - API response types (used by all API-calling domains)
+ - **dom.js** - DOM element types (used by all UI domains)
+ - **state.js** - State types (used by state management)
+ 
+ ### Domain Types (&#96;src/shared/domains/&#96;)
+ - One &#96;types.js&#96; file per domain
+ - Contains domain-specific type definitions
+ - Used by both client domain code and potentially server code
+ 
+ ### Utilities (&#96;src/shared/utils/&#96;)
+ - **error-handler.js** - Error handling utilities (used by all domains)
+ - **transitions.js** - Transition utilities
+ - **index.js** - Utility exports
+ 
+ ### Constants (&#96;src/shared/constants.js&#96;)
+ - Application-wide constants
+ - Used by all domains
+ 
+ ## Cross-Domain Relationships
+ 
+ &#96;&#96;&#96;
+ app.js (entry point)
+ ├── domains/auth/
+ ├── domains/sessions/
+ ├── domains/navigation/
+ ├── domains/reflection/
+ ├── domains/users/
+ └── domains/feedback/
+ 
+ Shared dependencies:
+ ├── shared/utils/error-handler.js
+ ├── shared/constants.js
+ ├── services/supabase-client.js
+ └── state/app-state.js
+ &#96;&#96;&#96;
+ 
+ ## Domain Import Patterns
+ 
+ ### Domain to Domain
+ &#96;&#96;&#96;javascript
+ // In sessions domain, importing from navigation
+ import { showPage } from &#39;../navigation/index.js&#39;;
+ &#96;&#96;&#96;
+ 
+ ### Domain to Shared
+ &#96;&#96;&#96;javascript
+ // In any domain
+ import { handleError, ERROR_SEVERITY } from &#39;../../../shared/utils/error-handler.js&#39;;
+ import { STORAGE_KEYS } from &#39;../../../shared/constants.js&#39;;
+ &#96;&#96;&#96;
+ 
+ ### Domain to Services
+ &#96;&#96;&#96;javascript
+ // In auth domain
+ import * as supabaseModule from &#39;../../services/supabase-client.js&#39;;
+ &#96;&#96;&#96;
+ 
+ ### Domain to State
+ &#96;&#96;&#96;javascript
+ // In sessions domain
+ import { getState, setState } from &#39;../../state/app-state.js&#39;;
+ &#96;&#96;&#96;
+ 
+ ## Notes
+ 
+ - **Entry Point**: &#96;src/client/app.js&#96; imports from all domains
+ - **Public APIs**: Each domain exports via &#96;index.js&#96;
+ - **Types**: Domain types are in &#96;src/shared/domains/{domain}/types.js&#96;
+ - **Utilities**: Domain-specific utils in &#96;{domain}/utils/&#96;, shared utils in &#96;src/shared/utils/&#96;
+ - **Subdomains**: Nested features use subdirectories (e.g., &#96;users/preferences/&#96;)
+ 
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="write">

<details><summary>Tool use: **code_edit** • Edit file: conventions/MIGRATION_STATUS.md</summary>

**Chunk 1**
Lines added: 181, lines removed: 1

```diff
@@ -1,1 +1,181 @@
- 
+ # Migration Status
+ 
+ This document tracks the current migration state and progress of the Better Life project toward established conventions.
+ 
+ ## Migration Overview
+ 
+ The project is in a transitional state, moving from a less structured codebase to a domain-driven, convention-following architecture.
+ 
+ ## Completed Migrations
+ 
+ ### ✅ Module System
+ - **Status**: Complete
+ - **Details**: All code uses ES6 modules (&#96;import&#96;/&#96;export&#96;)
+ - **Evidence**: All &#96;.js&#96; files use ES6 syntax, &#96;package.json&#96; has &#96;&quot;type&quot;: &quot;module&quot;&#96;
+ 
+ ### ✅ Error Handling
+ - **Status**: Mostly Complete
+ - **Details**: Centralized error handling via &#96;src/shared/utils/error-handler.js&#96;
+ - **Evidence**: Most code uses &#96;handleError()&#96; and &#96;withAsyncErrorHandling()&#96;
+ - **Remaining**: Some legacy code may still use direct &#96;console.error()&#96;
+ 
+ ### ✅ State Management
+ - **Status**: Complete
+ - **Details**: Unified state manager in &#96;src/client/state/state-manager.js&#96;
+ - **Evidence**: State is managed through &#96;getState()&#96;/&#96;setState()&#96; functions
+ - **Remaining**: Some code may still access &#96;state&#96; object directly (backward compatibility)
+ 
+ ### ✅ Domain Structure
+ - **Status**: Mostly Complete
+ - **Details**: Code organized into domains (auth, sessions, navigation, reflection, users, feedback)
+ - **Evidence**: &#96;src/client/domains/&#96; structure exists with domain folders
+ - **Remaining**: Some code may still be outside domain structure
+ 
+ ### ✅ Type Definitions
+ - **Status**: Complete
+ - **Details**: Types defined in &#96;src/shared/domains/&#96; and &#96;src/shared/types/&#96;
+ - **Evidence**: JSDoc typedefs exist for all major types
+ - **Remaining**: Some types may need refinement
+ 
+ ### ✅ Module Registry
+ - **Status**: Complete
+ - **Details**: Module registry replaces &#96;window.*&#96; pattern for cross-module dependencies
+ - **Evidence**: &#96;src/client/utils/module-registry.js&#96; exists and is used
+ - **Remaining**: Some legacy &#96;window.*&#96; fallbacks may still exist
+ 
+ ## In Progress Migrations
+ 
+ ### 🔄 Client-Server Separation
+ - **Status**: In Progress
+ - **Details**: Code is organized into &#96;src/client/&#96;, &#96;src/server/&#96;, &#96;src/shared/&#96;
+ - **Current State**: Structure exists, but some files may be in wrong locations
+ - **Remaining Work**:
+   - Verify all client code is in &#96;src/client/&#96;
+   - Verify all shared code is in &#96;src/shared/&#96;
+   - Ensure no mixing of concerns
+ 
+ ### 🔄 Import Path Consistency
+ - **Status**: In Progress
+ - **Details**: Standardizing import paths and patterns
+ - **Current State**: Most imports follow conventions, some deep paths exist
+ - **Remaining Work**:
+   - Review and optimize deep import paths (3+ levels)
+   - Ensure consistent import ordering
+   - Remove any remaining &#96;window.*&#96; dependencies
+ 
+ ### 🔄 Domain Public APIs
+ - **Status**: In Progress
+ - **Details**: Each domain should export clean public API via &#96;index.js&#96;
+ - **Current State**: Most domains have &#96;index.js&#96;, but some code may import directly
+ - **Remaining Work**:
+   - Ensure all domain imports go through &#96;index.js&#96;
+   - Verify no direct imports of internal domain files
+   - Complete feedback domain implementation
+ 
+ ## Pending Migrations
+ 
+ ### ⏳ Feedback Domain
+ - **Status**: Pending
+ - **Details**: Feedback UI is currently in &#96;app.js&#96;, should be in &#96;domains/feedback/&#96;
+ - **Current State**: &#96;domains/feedback/index.js&#96; is placeholder
+ - **Remaining Work**:
+   - Move feedback UI from &#96;app.js&#96; to &#96;domains/feedback/feedback-ui.js&#96;
+   - Implement feedback domain public API
+   - Update imports in &#96;app.js&#96;
+ 
+ ### ⏳ Inline Scripts
+ - **Status**: Pending
+ - **Details**: Some inline scripts in &#96;index.html&#96; should be converted to modules
+ - **Current State**: Some button handlers may still be inline
+ - **Remaining Work**:
+   - Convert inline scripts to modules
+   - Move to appropriate domain or utility file
+   - Remove inline script dependencies
+ 
+ ### ⏳ Test Coverage
+ - **Status**: Pending
+ - **Details**: Expand test coverage beyond guardrails
+ - **Current State**: Minimal guardrail tests exist
+ - **Remaining Work**:
+   - Add more comprehensive tests
+   - Consider adopting test framework
+   - Add UI/component tests
+ 
+ ## Known Inconsistencies
+ 
+ ### Code Organization
+ 1. **Feedback Domain** - Incomplete, UI code in &#96;app.js&#96;
+ 2. **Domain Utils** - Only sessions domain has &#96;utils/&#96; subdirectory
+ 3. **Service Layer** - Only sessions domain has &#96;-service.js&#96; file
+ 4. **UI Separation** - Not all domains have &#96;-ui.js&#96; files
+ 
+ ### Import Patterns
+ 1. **Deep Paths** - Some imports have 3+ levels of &#96;../&#96;
+ 2. **Window Fallbacks** - Some code still checks &#96;window.*&#96; for backward compatibility
+ 3. **Direct Imports** - Some code may import domain internals directly
+ 
+ ### Error Handling
+ 1. **Direct Console Logging** - Some code may still use &#96;console.log()&#96;/&#96;console.error()&#96; directly
+ 2. **Missing Context** - Some error handling may not include full context
+ 
+ ### Naming
+ 1. **Function Prefixes** - Not all functions follow prefix patterns consistently
+ 2. **File Naming** - Some files may not follow kebab-case consistently
+ 
+ ## Migration Priorities
+ 
+ ### High Priority
+ 1. Complete feedback domain migration
+ 2. Remove all &#96;window.*&#96; dependencies
+ 3. Ensure all domain imports go through public APIs
+ 
+ ### Medium Priority
+ 1. Optimize deep import paths
+ 2. Standardize domain structure (add &#96;-ui.js&#96; files where needed)
+ 3. Complete error handling migration
+ 
+ ### Low Priority
+ 1. Expand test coverage
+ 2. Adopt test framework
+ 3. Add comprehensive documentation
+ 
+ ## Migration Guidelines
+ 
+ ### For New Code
+ - **Always** follow established conventions
+ - **Always** use domain structure
+ - **Always** use error handling utilities
+ - **Always** use named exports
+ - **Always** import from domain &#96;index.js&#96; files
+ 
+ ### For Existing Code
+ - Migrate when touching code
+ - Don&#39;t break existing functionality
+ - Update incrementally
+ - Document migration progress
+ 
+ ## Tracking Migration
+ 
+ ### How to Update This Document
+ 1. Mark completed migrations as ✅
+ 2. Update in-progress migrations with current state
+ 3. Add new migrations as they&#39;re identified
+ 4. Note inconsistencies as they&#39;re discovered
+ 
+ ### Migration Checklist Template
+ &#96;&#96;&#96;markdown
+ ### Migration Name
+ - **Status**: [Complete/In Progress/Pending]
+ - **Details**: Description of what&#39;s being migrated
+ - **Current State**: What exists now
+ - **Remaining Work**: What needs to be done
+ &#96;&#96;&#96;
+ 
+ ## Notes
+ 
+ - Migration is ongoing and incremental
+ - Not all code needs to be migrated immediately
+ - Focus on new code following conventions
+ - Migrate existing code when it&#39;s being modified
+ - Document decisions and patterns as they&#39;re established
+ 
```

</details>

</tool-use>

---



---


Populated all convention files. Checking for linting issues:


---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 1 file</summary>
      
Lint paths:

- `conventions`

Lint results


**No lint errors found**
</details>
</tool-use>

---



---


Populated all convention files in the `conventions` folder. Summary:

## Convention files populated

1. **README.md** — Overview of the conventions directory and its purpose
2. **folder-structure.md** — Directory organization, file placement rules, and structure patterns
3. **naming-conventions.md** — Naming patterns for files, functions, variables, types, and DOM elements
4. **error-handling.md** — Standardized error handling patterns using the centralized error handler
5. **imports-and-dependencies.md** — ES6 module import patterns, dependency management, and path conventions
6. **client-server-boundaries.md** — Separation between client, server, and shared code
7. **testing-organization.md** — Test structure, guardrail testing philosophy, and test patterns
8. **DOMAIN_STRUCTURE_PROPOSAL.md** — Domain-driven design organization and domain principles
9. **DOMAIN_STRUCTURE_TREE.md** — Visual tree representation of the domain structure
10. **MIGRATION_STATUS.md** — Current migration state, completed work, and known inconsistencies

## Findings documented

Each file includes:
- Established patterns — conventions consistently followed
- Inconsistencies — areas where patterns are not yet standardized
- Best practices — recommendations for future development
- Migration notes — guidance for transitioning legacy code

## Highlights

- Domain-driven structure with 6 domains (auth, sessions, navigation, reflection, users, feedback)
- ES6 modules throughout
- Centralized error handling with severity levels
- Guardrail testing approach
- Clear client/server/shared separation
- Consistent naming patterns (kebab-case files, camelCase variables, PascalCase types)

All files are ready for use as reference documentation for the project.

---

